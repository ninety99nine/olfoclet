"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[647],{58174:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(23645),o=s.n(r)()((function(e){return e[1]}));o.push([e.id,".ussd_input{background:transparent;border:none;border-bottom:2px solid #11d8b3!important;border-radius:0;box-shadow:none!important;padding:0;width:100%}",""]);const i=o},647:(e,t,s)=>{s.r(t),s.d(t,{default:()=>M});var r=s(58222),o={class:"absolute top-20 right-5 left-5"},i={class:"bg-white/90 shadow-sm hover:shadow-md rounded-sm p-4 mb-2"},n={class:"text-sm font-semibold tracking-tight text-gray-900"},a={class:"text-blue-500 mr-1"},u={class:"text-xs"},l={class:"bg-white/90 shadow-sm hover:shadow-md rounded-sm p-4 mb-2"},d={class:"flex justify-between mb-4"},c=(0,r.createElementVNode)("span",{class:"block text-sm font-medium text-gray-900"},"Dialer",-1),m={class:"flex text-gray-900"},p=(0,r.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[(0,r.createElementVNode)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1),h={class:"block text-sm font-medium"},f={class:"bg-white/90 shadow-sm hover:shadow-md rounded-sm p-4"},g={class:"text-sm font-semibold tracking-tight text-gray-600 text-justify"},v={class:"text-blue-500"},y={class:"flex justify-center pt-4 mt-4 border-t border-dashed border-gray-300"},b={class:"absolute top-40 right-5 left-5"},w={class:"bg-white/90 shadow-sm hover:shadow-md rounded-sm p-4 relative"},S=(0,r.createElementVNode)("span",{class:"text-gray-600 ml-2"},"Loading...",-1),x={key:1},V=["innerHTML"],C=["disabled"],N={class:"w-3/4 m-auto flex justify-between mt-4"},_=(0,r.createElementVNode)("span",null,"|",-1),U={class:"flex justify-end mt-4 border-gray-300"};var k=s(6154),E=s(11879),P=s(66222),q=s(91098),j=s(79152),O=s(48795);function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}function T(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function R(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?T(Object(s),!0).forEach((function(t){$(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):T(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function $(e,t,s){return(t=function(e){var t=function(e,t){if("object"!==D(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!==D(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===D(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const B={components:$({DefaultInput:P.Z,DangerButton:j.Z,PrimaryButton:O.Z,Loader:E.Z},"Loader",E.Z),data:function(){return{project:this.$page.props.projectPayload,version:this.$page.props.versionPayload,useVersionBuilder:(0,q.P)(),app:this.$page.props.appPayload,simulator:null}},computed:{shortCode:function(){return this.app.short_code||{}},sharedShortCode:function(){return this.shortCode.shared_code},dedicatedShortCode:function(){return this.shortCode.dedicated_code},primaryShortCode:function(){return this.dedicatedShortCode||this.sharedShortCode},modifiedServiceCode:function(){function e(e,t,s){return""}var t=/[^0-9a-zA-Z\s*]|^[*]+|[*]+$/g,s=this.simulator.initialReplies.replace(t,e);t=/[*]{2,}/g;return(s=s.replace(t,e))?this.primaryShortCode.substring(0,this.primaryShortCode.length-1)+"*"+s+"#":this.primaryShortCode}},methods:{startUssdServiceSimulator:function(){0==this.simulator.loading&&(this.resetUssdSimulator(),this.startApiSimulationRequest(),this.showUssdPopup())},stopUssdSimulator:function(){this.stopApiSimulationRequest(),this.resetUssdSimulator(),this.cancelUssdCall(),this.hideUssdPopup()},resetUssdSimulator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.simulator.form=R(R({},this.defaultForm()),e)},cancelUssdCall:function(){this.simulator.request&&this.simulator.request.cancel("Session cancelled"),this.simulator.loading=!1},defaultForm:function(){return{msg:null,request_type:1,session_id:null,service_code:null,test_mode:!0,app_id:this.app.id,version_id:this.version.id,msisdn:this.useVersionBuilder.builder.simulator.subscriber.phone_number}},startLastUssdCall:function(){var e=this.simulator.form.session_id;this.resetUssdSimulator({session_id:e,request_type:2}),this.startApiSimulationRequest()},startApiSimulationRequest:function(){var e=this,t=this;1==this.simulator.form.request_type&&(this.simulator.form.msg=this.modifiedServiceCode),this.simulator.loading=!0;var s=k.Z.CancelToken.source(),r=route("launch.ussd.simulation");this.simulator.request={cancel:s.cancel},k.Z.post(r,this.simulator.form,{cancelToken:s.token}).then((function(e){var s,r=1==t.simulator.form.request_type,o=e.data;(t.simulator.last_session_id=o.session_id,t.simulator.ussdResponseMsg=o.msg,t.simulator.form.session_id=o.session_id,t.simulator.form.request_type=o.request_type,t.simulator.form.service_code=o.service_code,t.$emit("response",o),2==t.simulator.form.request_type?(t.emptyInput(),t.focusOnInput(),r&&t.$message({message:"Simulation started successfully",type:"success"})):3==t.simulator.form.request_type?(t.resetUssdSimulator(),t.emptyInput(),t.$message({message:"Session ended",type:"warning"})):4==t.simulator.form.request_type?(t.emptyInput(),t.$message({message:"Session Timed out",type:"warning"})):5==t.simulator.form.request_type&&t.redirectUssdSimulator(o.msg),200===e.status)||(t.resetUssdSimulator(),t.hideUssdPopup(),t.$message({message:null!==(s=(e||{}).message)&&void 0!==s?s:"Sorry, something went wrong",type:"warning"}))})).catch((function(s){var r;e.resetUssdSimulator(),e.hideUssdPopup();var o=null!==(r=(s||{}).message)&&void 0!==r?r:"Sorry, something went wrong";419===s.response.status&&(o="Please login",e.$inertia.get(route("login.show"))),t.$message({message:o,type:"warning"})})).finally((function(){e.simulator.request=null,e.simulator.loading=!1}))},stopApiSimulationRequest:function(){var e=this,t=route("stop.ussd.simulation",{session_id:this.simulator.last_session_id});k.Z.post(t).then((function(e){})).catch((function(t){var s,r=null!==(s=(t||{}).message)&&void 0!==s?s:"Sorry, something went wrong";419===t.response.status&&(r="Please login",e.$inertia.get(route("login.show"))),self.$message({message:r,type:"warning"})}))},redirectUssdSimulator:function(e){this.resetUssdSimulator(),this.focusOnInput(),this.simulator.form.serviceCode=e,this.startApiSimulationRequest()},showUssdPopup:function(){this.simulator.showingUssdPopup=!0,this.focusOnInput()},hideUssdPopup:function(){this.simulator.showingUssdPopup=!1},focusOnInput:function(){var e=this;setTimeout((function(){e.$refs.ussd_input&&e.$refs.ussd_input.focus()}),100)},emptyInput:function(){this.simulator.form.msg=null}},created:function(){this.simulator=this.useVersionBuilder.simulator,this.simulator.form=this.defaultForm()},beforeUnmount:function(){this.simulator.form.session_id&&this.stopApiSimulationRequest()}};var Z=s(93379),A=s.n(Z),I=s(58174),L={insert:"head",singleton:!1};A()(I.Z,L);I.Z.locals;const M=(0,s(83744).Z)(B,[["render",function(e,t,s,k,E,P){var q=(0,r.resolveComponent)("DefaultInput"),j=(0,r.resolveComponent)("PrimaryButton"),O=(0,r.resolveComponent)("Loader"),D=(0,r.resolveComponent)("DangerButton");return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:(0,r.normalizeClass)(["h-full relative",{"bg-black/50":E.simulator.showingUssdPopup}])},[(0,r.createVNode)(r.Transition,{name:"fade"},{default:(0,r.withCtx)((function(){return[(0,r.withDirectives)((0,r.createElementVNode)("div",o,[(0,r.createElementVNode)("div",i,[(0,r.createElementVNode)("span",n,[(0,r.createElementVNode)("span",a,(0,r.toDisplayString)(E.app.name),1),(0,r.createElementVNode)("span",u," â€” Version "+(0,r.toDisplayString)(E.version.number),1)])]),(0,r.createElementVNode)("div",l,[(0,r.createElementVNode)("div",d,[c,(0,r.createElementVNode)("div",m,[p,(0,r.createElementVNode)("span",h,(0,r.toDisplayString)(E.simulator.form.msisdn),1)])]),(0,r.createVNode)(q,{modelValue:E.simulator.initialReplies,"onUpdate:modelValue":t[0]||(t[0]=function(e){return E.simulator.initialReplies=e}),placeholder:"*1*2*3",prependClasses:["bg-blue-50 text-blue-500"],appendClasses:["bg-blue-50 text-blue-500"]},{append:(0,r.withCtx)((function(){return[(0,r.createTextVNode)((0,r.toDisplayString)(P.primaryShortCode.substring(0,P.primaryShortCode.length-1))+"* ",1)]})),prepend:(0,r.withCtx)((function(){return[(0,r.createTextVNode)(" # ")]})),_:1},8,["modelValue"])]),(0,r.createElementVNode)("div",f,[(0,r.createElementVNode)("span",g,[(0,r.createElementVNode)("span",null,[(0,r.createTextVNode)("Dial "),(0,r.createElementVNode)("span",v,(0,r.toDisplayString)(P.modifiedServiceCode),1),(0,r.createTextVNode)(" on your mobile device or "),(0,r.createElementVNode)("span",{class:"text-blue-500 hover:text-blue-600 active:text-blue-700 underline cursor-pointer",onClick:t[1]||(t[1]=function(){return P.startUssdServiceSimulator&&P.startUssdServiceSimulator.apply(P,arguments)})},"Launch Simulator"),(0,r.createTextVNode)(" to experience your application.")])]),(0,r.createElementVNode)("div",y,[(0,r.createVNode)(j,{onClick:t[2]||(t[2]=function(e){return P.startUssdServiceSimulator()})},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)("Launch Simulator")]})),_:1})])])],512),[[r.vShow,!E.simulator.showingUssdPopup]])]})),_:1}),(0,r.createVNode)(r.Transition,{name:"fade"},{default:(0,r.withCtx)((function(){return[(0,r.withDirectives)((0,r.createElementVNode)("div",b,[(0,r.createElementVNode)("div",w,[E.simulator.loading?((0,r.openBlock)(),(0,r.createBlock)(O,{key:0,withTransition:!1},{default:(0,r.withCtx)((function(){return[S]})),_:1})):((0,r.openBlock)(),(0,r.createElementBlock)("div",x,[(0,r.createElementVNode)("p",{class:"text-gray-600 whitespace-pre-wrap mb-4",innerHTML:E.simulator.ussdResponseMsg},null,8,V),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=function(e){return E.simulator.form.msg=e}),disabled:E.simulator.loading,ref:"ussd_input",class:"ussd_input",onKeypress:t[4]||(t[4]=(0,r.withKeys)((function(e){return P.startApiSimulationRequest()}),["enter"])),onKeyup:t[5]||(t[5]=(0,r.withKeys)((function(e){return P.stopUssdSimulator()}),["esc"]))},null,40,C),[[r.vModelText,E.simulator.form.msg]]),(0,r.createElementVNode)("div",N,[(0,r.createElementVNode)("button",{class:"text-gray-600 hover:text-red-500 active:text-red-600 cursor-pointer",onClick:t[6]||(t[6]=function(e){return P.stopUssdSimulator()})},"Cancel"),_,(0,r.createElementVNode)("button",{class:"text-gray-600 hover:text-blue-500 active:text-blue-600 cursor-pointer",onClick:t[7]||(t[7]=function(e){return P.startApiSimulationRequest()})},"Send")])]))]),(0,r.createElementVNode)("div",U,[(0,r.withDirectives)((0,r.createVNode)(j,{onClick:t[8]||(t[8]=function(e){return P.startUssdServiceSimulator()}),class:"mr-2"},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)("Restart")]})),_:1},512),[[r.vShow,!E.simulator.loading]]),(0,r.withDirectives)((0,r.createVNode)(j,{onClick:t[9]||(t[9]=function(e){return P.startLastUssdCall()})},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)("Re-run")]})),_:1},512),[[r.vShow,!E.simulator.loading]]),(0,r.withDirectives)((0,r.createVNode)(D,{onClick:t[10]||(t[10]=function(e){return P.stopUssdSimulator()})},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)("Stop")]})),_:1},512),[[r.vShow,E.simulator.loading]])])],512),[[r.vShow,E.simulator.showingUssdPopup]])]})),_:1})],2)}]])}}]);